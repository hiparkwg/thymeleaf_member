<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

    <select id="search" parameterType="String" resultType="MemberVo">
        select id, name, address1, phone, photo  from member 
        where name like     '%${_parameter}%'
        or    address1 like '%${_parameter}%'
        or    phone like    '%${_parameter}%'
                           
    </select>
    <select id="view" parameterType="String" resultType="MemberVo">
        select id, name, address1, phone, photo from member
        where id=#{_parameter}
    </select>
    <select id="photos" parameterType="String" resultType="PhotoVo">
        select sno, photo, oriPhoto, flag, nal from photos
        where id=#{_parameter}
    </select>


    <insert id="register" parameterType="MemberVo">
        insert into member(id, name, address1, phone, photo)
        values(#{id}, #{name}, #{address1}, #{phone}, #{photo});

        <if test="photos != null ">
            insert into photos(id, oriPhoto) values
            <foreach collection="photos" item="p" separator=",">
                (#{id}, #{p.oriPhoto})
            </foreach>
        </if>
    </insert>

    <update id="update" parameterType="MemberVo">
        update member set name=#{name}, address1=#{address1}, phone=#{phone}
        where id=#{id};
        <if test="photos != null ">
            insert into photos(id, oriPhoto) values
            <foreach collection="photos" item="p" separator=",">
                (#{id}, #{p.oriPhoto})
            </foreach>
        </if>
    </update>

    <update id="change_photo" parameterType="Map">
        update member set  photo=#{photo} where id=#{id}
    </update>


    <delete id="delete_files" parameterType="java.util.List">
        delete from photos where oriPhoto in
        <foreach collection="list" item="file"  open="(" close=")" separator=",">
            #{file}
        </foreach>
    </delete>
    <delete id="delete_member" parameterType="String">
        delete from member where id=#{_parameter}
    </delete>

    <delete id="delete_photos" parameterType="String">
        delete from photos where id=#{_parameter}
    </delete>
</mapper>